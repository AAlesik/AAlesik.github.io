<!--
  Concept Artist Portfolio â€“ Three.js (Multiâ€‘Page, Dataâ€‘Driven)
  -------------------------------------------------------------
  ðŸ“ Projektstruktur (neu)
  â”œâ”€ index.html                (Landing, Teaser)
  â”œâ”€ gallery-2d.html           (2D/Concept Galerie â€“ DATENGETRIEBEN)
  â”œâ”€ gallery-3d.html           (3Dâ€‘Modelle Preview â€“ DATENGETRIEBEN)
  â”œâ”€ styles.css                (globales Styling)
  â”œâ”€ main.js                   (UI + Three.js + Renderlogik)
  â”œâ”€ data/
  â”‚   â””â”€ gallery-data.js       ("CMS"-artige Datenquelle â€“ hier nur EintrÃ¤ge ergÃ¤nzen)
  â””â”€ assets/                   (Bilder, GLB/GLTF, PDFs)
-->

<!-- ========================= index.html ========================= -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dein Name â€“ Concept Artist</title>
  <meta name="description" content="Portfolio von [Dein Name], Concept Artist fÃ¼r Games & Film. Environments, Props, Charaktere." />
  <meta property="og:title" content="[Dein Name] â€“ Concept Artist" />
  <meta property="og:description" content="Environments, Props, Charaktere. Portfolio & Kontakt." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/cover.jpg" />
  <meta name="theme-color" content="#0b0c10" />
  <link rel="preload" as="image" href="assets/cover.jpg" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="Hauptnavigation">
      <div class="brand"><span class="brand-badge" aria-hidden="true"></span> <a href="index.html">[Dein Name]</a></div>
      <ul>
        <li><a href="gallery-2d.html" class="btn">2D Galerie</a></li>
        <li><a href="gallery-3d.html" class="btn">3D Modelle</a></li>
        <li><a href="#about" class="btn">Ãœber mich</a></li>
        <li><a href="#contact" class="btn primary"><span class="dot"></span> Kontakt</a></li>
      </ul>
    </div>
  </header>

  <main id="top">
    <!-- HERO -->
    <section class="hero" aria-label="Hero">
      <div class="canvas-wrap" aria-hidden="true">
        <canvas class="webgl" id="bg"></canvas>
      </div>
      <div class="hero-inner container">
        <div class="eyebrow">Concept Art â€¢ Games â€¢ Film</div>
        <h1>[Dein Name]</h1>
        <p class="subtitle">Environments, Props & Keyframes mit Fokus auf stimmige Welten, glaubwÃ¼rdige Materialien und klare Story Beats.</p>
        <div class="cta">
          <a href="gallery-2d.html" class="btn primary">2Dâ€‘Portfolio ansehen</a>
          <a href="gallery-3d.html" class="btn">3Dâ€‘Previews</a>
          <a href="assets/DeinName_CV.pdf" class="btn" download>CV / PDF</a>
        </div>
      </div>
    </section>

    <!-- FEATURED -->
    <section class="container" aria-label="AusgewÃ¤hlte Arbeiten">
      <div class="section-head">
        <h2>AusgewÃ¤hlte Arbeiten</h2>
        <p class="muted">Mehr in der <a href="gallery-2d.html">2Dâ€‘Galerie</a></p>
      </div>
      <div id="featured-grid" class="grid" data-page="featured"></div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="container" aria-label="Ãœber mich">
      <div class="section-head">
        <h2>Ãœber mich</h2>
        <p class="muted">Tools, Schwerpunkte & Workflow</p>
      </div>
      <div class="about">
        <div>
          <p>Ich bin Concept Artist aus [Stadt], mit Fokus auf <strong>Environments</strong>, <strong>Props</strong> und <strong>Keyframes</strong>. Ich liebe klare Formen, glaubwÃ¼rdige Materialien und Designs, die Gameplay & Story unterstÃ¼tzen.</p>
          <p>Ich arbeite effizient mit 3Dâ€‘Blockouts (Blender) fÃ¼r Perspektive & Lighting und male darÃ¼ber fÃ¼r schnelle Iteration. Offen fÃ¼r Freelance und Studioâ€‘Positionen.</p>
        </div>
        <aside>
          <div class="pillset" aria-label="Skills">
            <span class="pill">Photoshop</span>
            <span class="pill">Blender</span>
            <span class="pill">Kitbash/3D</span>
            <span class="pill">Keyframes</span>
            <span class="pill">Color/Light</span>
            <span class="pill">Hardâ€‘Surface</span>
            <span class="pill">Worldbuilding</span>
          </div>
        </aside>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="container" aria-label="Kontakt">
      <div class="section-head">
        <h2>Kontakt</h2>
        <p class="muted">Projektanfrage, Portfolioâ€‘Review oder einfach Hallo sagen</p>
      </div>
      <div class="contact-box">
        <p>Am besten per Eâ€‘Mail: <a href="mailto:hello@deinname.art">hello@deinname.art</a></p>
        <div class="contact-actions">
          <a class="btn" href="mailto:hello@deinname.art">Eâ€‘Mail senden</a>
          <a class="btn" href="https://www.artstation.com/" target="_blank" rel="noreferrer">ArtStation</a>
          <a class="btn" href="https://www.instagram.com/" target="_blank" rel="noreferrer">Instagram</a>
          <a class="btn" href="https://www.linkedin.com/" target="_blank" rel="noreferrer">LinkedIn</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">Â© <span id="year"></span> [Dein Name] â€” Alle Rechte vorbehalten.</div>
  </footer>

  <!-- LIGHTBOX -->
  <dialog id="lightbox" aria-label="Vorschau" aria-busy="false">
    <div class="lightbox-head">
      <strong id="lb-title"></strong>
      <button id="lb-close" class="btn" style="margin-left:auto">SchlieÃŸen</button>
    </div>
    <div class="lightbox-body">
      <div id="lb-stage" aria-live="polite"></div>
      <div class="lb-progress" hidden>
        <span class="bar"></span>
        <span class="label" aria-live="polite" aria-atomic="true">0%</span>
      </div>
      <p id="lb-tags" class="muted" style="margin:.6rem 0 1rem"></p>
    </div>
  </dialog>

  <script type="importmap">{"imports":{"three":"https://unpkg.com/three@0.161.0/build/three.module.js"}}</script>
  <script src="data/gallery-data.js"></script>
  <script type="module" src="main.js"></script>
</body>
</html>


<!-- ========================= gallery-2d.html ========================= -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2D Galerie â€“ [Dein Name]</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="brand-badge" aria-hidden="true"></span> <a href="index.html">[Dein Name]</a></div>
      <ul>
        <li><a href="gallery-2d.html" class="btn">2D Galerie</a></li>
        <li><a href="gallery-3d.html" class="btn">3D Modelle</a></li>
        <li><a href="index.html#contact" class="btn primary"><span class="dot"></span> Kontakt</a></li>
      </ul>
    </div>
  </header>

  <main>
    <section class="container" aria-label="2D Galerie">
      <div class="section-head">
        <h2>2D / Concept Art</h2>
        <p class="muted">Klicke ein Bild fÃ¼r Details (Klickâ€‘Zoom verfÃ¼gbar)</p>
      </div>
      <div id="grid-2d" class="grid" data-page="2d"></div>
    </section>
  </main>

  <footer>
    <div class="container">Â© <span id="year"></span> [Dein Name]</div>
  </footer>

  <dialog id="lightbox" aria-label="Bildvorschau" aria-busy="false">
    <div class="lightbox-head">
      <strong id="lb-title"></strong>
      <button id="lb-close" class="btn" style="margin-left:auto">SchlieÃŸen</button>
    </div>
    <div class="lightbox-body">
      <div id="lb-stage" aria-live="polite"></div>
      <div class="lb-progress" hidden>
        <span class="bar"></span>
        <span class="label" aria-live="polite" aria-atomic="true">0%</span>
      </div>
      <p id="lb-tags" class="muted" style="margin:.6rem 0 1rem"></p>
    </div>
  </dialog>

  <script type="importmap">{"imports":{"three":"https://unpkg.com/three@0.161.0/build/three.module.js"}}</script>
  <script src="data/gallery-data.js"></script>
  <script type="module" src="main.js"></script>
</body>
</html>


<!-- ========================= gallery-3d.html ========================= -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Modelle â€“ [Dein Name]</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="brand-badge" aria-hidden="true"></span> <a href="index.html">[Dein Name]</a></div>
      <ul>
        <li><a href="gallery-2d.html" class="btn">2D Galerie</a></li>
        <li><a href="gallery-3d.html" class="btn">3D Modelle</a></li>
        <li><a href="index.html#contact" class="btn primary"><span class="dot"></span> Kontakt</a></li>
      </ul>
    </div>
  </header>

  <main>
    <section class="container" aria-label="3D Galerie">
      <div class="section-head">
        <h2>3D Modelle (GLB/GLTF)</h2>
        <p class="muted">Klicke fÃ¼r interaktive Vorschau</p>
      </div>
      <div id="grid-3d" class="grid" data-page="3d"></div>
    </section>
  </main>

  <footer>
    <div class="container">Â© <span id="year"></span> [Dein Name]</div>
  </footer>

  <dialog id="lightbox" aria-label="3D Vorschau" aria-busy="false">
    <div class="lightbox-head">
      <strong id="lb-title"></strong>
      <button id="lb-close" class="btn" style="margin-left:auto">SchlieÃŸen</button>
    </div>
    <div class="lightbox-body">
      <div id="lb-stage" aria-live="polite"></div>
      <div class="lb-progress" hidden>
        <span class="bar"></span>
        <span class="label" aria-live="polite" aria-atomic="true">0%</span>
      </div>
      <p id="lb-tags" class="muted" style="margin:.6rem 0 1rem"></p>
    </div>
  </dialog>

  <script type="importmap">{"imports":{"three":"https://unpkg.com/three@0.161.0/build/three.module.js"}}</script>
  <script src="data/gallery-data.js"></script>
  <script type="module" src="main.js"></script>
</body>
</html>


<!-- ========================= styles.css ========================= -->
:root { --bg:#0b0c10; --fg:#e5e7eb; --muted:#9aa0a6; --brand:#8bd3dd; --accent:#eab308; --card:#111318; --border:#1f232b; --maxw:1200px; --radius:20px; --shadow:0 10px 30px rgba(0,0,0,.35); }
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif; color:var(--fg); background: radial-gradient(1200px 600px at 80% -20%, #132034 0%, transparent 60%), var(--bg); line-height:1.55; }
a{ color:inherit; text-decoration:none; }
img,canvas{ max-width:100%; display:block; }
.container{ width:min(100% - 2rem, var(--maxw)); margin-inline:auto; }
header{ position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(8px); background: linear-gradient(to bottom, rgba(11,12,16,.8), rgba(11,12,16,.35)); border-bottom:1px solid var(--border); }
.nav{ display:flex; align-items:center; justify-content:space-between; padding:.9rem 0; }
.brand{ display:flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.4px; }
.brand-badge{ width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg, var(--brand), #a5f3fc); box-shadow:var(--shadow); }
.nav a{ opacity:.9; }
.nav ul{ display:flex; gap:1rem; list-style:none; padding:0; margin:0; }
.btn{ display:inline-flex; align-items:center; gap:.5rem; border:1px solid var(--border); background:#0e1016; padding:.6rem 1rem; border-radius:999px; transition: transform .2s ease, background .2s ease, border-color .2s ease; }
.btn:hover{ transform:translateY(-1px); border-color:#2a3140; }
.btn.primary{ background: linear-gradient(135deg, #0e1a28, #0b1220); border-color:#222a38; }
.btn .dot{ width:8px; height:8px; border-radius:999px; background:var(--brand); box-shadow:0 0 12px var(--brand); }
.hero{ position:relative; min-height:78vh; display:grid; place-items:center; overflow:clip; }
.hero-inner{ position:relative; z-index:2; text-align:center; padding:6rem 0 4rem; }
.eyebrow{ text-transform:uppercase; letter-spacing:.28em; font-size:.8rem; color:var(--muted); }
h1{ font-size:clamp(2.4rem, 6vw, 4.4rem); line-height:1.05; margin:.6rem 0 1rem; }
.subtitle{ color:#cbd5e1; max-width:60ch; margin-inline:auto; }
.cta{ margin-top:1.6rem; display:flex; gap:.8rem; justify-content:center; flex-wrap:wrap; }
.canvas-wrap{ position:absolute; inset:0; z-index:1; }
canvas.webgl{ width:100%; height:100%; display:block; }
section{ padding:4.5rem 0; }
.section-head{ display:flex; align-items:end; justify-content:space-between; gap:1rem; margin-bottom:1.6rem; }
.section-head h2{ margin:0; font-size:clamp(1.6rem, 4.2vw, 2.2rem); }
.muted{ color:var(--muted); font-size:.95rem; }
.grid{ display:grid; grid-template-columns:repeat(12, 1fr); gap:1rem; }
.card{ grid-column:span 4; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00)); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); transition: transform .25s ease, box-shadow .25s ease; }
.card:hover{ transform:translateY(-4px); }
.card figure{ aspect-ratio:4/3; background:#0a0c12; overflow:hidden; }
.card img{ width:100%; height:100%; object-fit:cover; filter:saturate(1.05) contrast(1.03); }
.card .meta{ padding:.9rem .95rem; display:flex; align-items:center; justify-content:space-between; }
.tag{ font-size:.78rem; color:#a2a9b7; border:1px solid var(--border); background:#0d1017; padding:.25rem .55rem; border-radius:999px; }
.about{ display:grid; grid-template-columns:1.2fr .8fr; gap:2rem; align-items:start; }
.pillset{ display:flex; gap:.5rem; flex-wrap:wrap; }
.pill{ background:#0f131b; border:1px solid var(--border); padding:.4rem .7rem; border-radius:999px; font-size:.85rem; }
.projects .card{ grid-column:span 6; display:grid; grid-template-rows:auto 1fr auto; }
.projects .card .meta{ gap:.8rem; flex-wrap:wrap; align-items:start; }
.contact-box{ background: linear-gradient(180deg, rgba(139,211,221,.08), rgba(139,211,221,.02)); border:1px solid #2a3440; padding:2rem; border-radius:var(--radius); display:grid; gap:1rem; box-shadow:var(--shadow); }
.contact-actions{ display:flex; gap:.8rem; flex-wrap:wrap; }
footer{ border-top:1px solid var(--border); padding:2rem 0; color:var(--muted); text-align:center; }
/* Lightbox â€“ mittig & flexibel */
dialog#lightbox{ width:min(94vw, 1200px); border:1px solid var(--border); padding:0; border-radius:14px; background:#0a0d14; }
dialog::backdrop{ background:rgba(0,0,0,.7); }
.lightbox-head{ display:flex; justify-content:space-between; align-items:center; padding:.7rem 1rem; border-bottom:1px solid var(--border); }
.lightbox-body{ padding:1rem; display:flex; flex-direction:column; align-items:center; justify-content:center; }
#lb-stage{ width:100%; display:grid; place-items:center; overflow:hidden; }
#lb-stage img, #lb-stage canvas{ max-width:100%; max-height:72vh; margin:0 auto; object-fit:contain; }
#lb-tags{ text-align:center; }
/* 2D Zoom */
#lb-stage img.zoomable{ cursor:zoom-in; transition: transform .15s ease; }
#lb-stage img.zoomable.zoomed{ cursor:grab; }
/* Progress Bar */
.lb-progress{ width:100%; height:24px; background:#1f232b; border-radius:8px; overflow:hidden; margin-top:.6rem; position:relative; display:flex; align-items:center; }
.lb-progress>.bar{ display:block; height:6px; width:0%; background:var(--brand); margin-left:6px; border-radius:4px; transition: width .2s ease; }
.lb-progress>.label{ position:absolute; right:10px; font-size:.85rem; color:#cbd5e1; }

/* Responsive */
@media (max-width:1000px){ .card{ grid-column:span 6; } .about{ grid-template-columns:1fr; } }
@media (max-width:640px){ .card{ grid-column:span 12; } .projects .card{ grid-column:span 12; } .nav ul{ display:none; } }
@media (prefers-reduced-motion:reduce){ .canvas-wrap{ display:none; } }


<!-- ========================= data/gallery-data.js ========================= -->
// CMS-artige Datenquelle
// type: 'image' (2D/Still) oder 'gltf' (3Dâ€‘Model)
// Optional bei 3D: env:'assets/env/studio.hdr'
window.GALLERY_DATA = {
  twoD: [
    { id: 'w01', type: 'image', title: 'Dunes Outpost', tags: ['Environment'], thumb: 'assets/work_01_thumb.webp', src: 'assets/work_01.webp', desc: 'Matteâ€‘Environment in der WÃ¼ste.' },
    { id: 'w02', type: 'image', title: 'Orbital Dock', tags: ['Sciâ€‘Fi'], thumb: 'assets/work_02_thumb.webp', src: 'assets/work_02.webp', desc: 'Hardâ€‘Surface Lookdev & Keyframe.' },
    { id: 'w03', type: 'image', title: 'Forest Shrine', tags: ['Keyframe','Fantasy'], thumb: 'assets/work_03_thumb.webp', src: 'assets/work_03.webp', desc: 'Keyframe mit Fokus auf Lichtstimmung.' },
    { id: 'w04', type: 'image', title: 'Courier Bot', tags: ['Prop'], thumb: 'assets/work_04_thumb.webp', src: 'assets/work_04.webp', desc: 'Prop Design â€“ Utility Bot.' },
    { id: 'w05', type: 'image', title: 'Glacier City', tags: ['Environment'], thumb: 'assets/work_05_thumb.webp', src: 'assets/work_05.webp', desc: 'Arktisches Cityâ€‘Concept.' },
    { id: 'w06', type: 'image', title: 'Desert Rover', tags: ['Vehicle'], thumb: 'assets/work_06_thumb.webp', src: 'assets/work_06.webp', desc: 'Vehicle Design â€“ Explorer.' }
  ],
  threeD: [
    { id: 'm01', type: 'gltf', title: 'Scout Drone', tags: ['Hardâ€‘Surface','GLB'], thumb: 'assets/m01_thumb.webp', src: 'assets/models/scout_drone.glb', desc: 'Lowâ€‘poly mit PBR.' },
    { id: 'm02', type: 'gltf', title: 'Temple Ruin', tags: ['Environment','GLTF'], thumb: 'assets/m02_thumb.webp', src: 'assets/models/temple_ruin.glb', desc: 'Modular Environment Set.' }
  ]
};


<!-- ========================= main.js ========================= -->
// Footer Jahr
const yearEl = document.getElementById('year');
if (yearEl) yearEl.textContent = new Date().getFullYear();

// Lightbox Elemente
const dialog = document.getElementById('lightbox');
const lbStage = document.getElementById('lb-stage');
const lbTitle = document.getElementById('lb-title');
const lbTags = document.getElementById('lb-tags');
const lbClose = document.getElementById('lb-close');
const lbProgress = document.querySelector('.lb-progress');
const lbBar = lbProgress ? lbProgress.querySelector('.bar') : null;
const lbLabel = lbProgress ? lbProgress.querySelector('.label') : null;
if (dialog && lbClose) {
  lbClose.addEventListener('click', () => dialog.close());
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && dialog.open) dialog.close(); });
}

function focusClose(){ if(lbClose){ setTimeout(()=> lbClose.focus(), 0); } }

// 2D Lightbox mit 1Ã—/2Ã—/4Ã— Klickâ€‘Zoom & Dragâ€‘Pan
function openLightboxForImage(item) {
  lbStage.innerHTML = '';
  if (lbProgress) lbProgress.hidden = true;
  dialog.setAttribute('aria-busy','false');
  const img = document.createElement('img');
  img.src = item.src; img.alt = `${item.title} â€“ GroÃŸansicht`;
  img.className = 'zoomable'; img.draggable = false;
  lbStage.appendChild(img);
  lbTitle.textContent = item.title;
  lbTags.textContent = item.desc || (item.tags?.join(', ') || '');
  dialog.showModal(); focusClose();

  const levels = [1,2,4]; let li = 0; // index im levelsâ€‘Array
  let startX=0, startY=0, curX=0, curY=0, dragging=false;
  function apply(){ img.style.transform = `translate(${curX}px, ${curY}px) scale(${levels[li]})`; img.classList.toggle('zoomed', levels[li]>1); img.style.cursor = levels[li]>1 ? (dragging?'grabbing':'grab') : 'zoom-in'; }
  apply();

  img.addEventListener('click', (e)=>{
    if (dragging) return; // Klick nach Drag ignorieren
    const prev = li; li = (li + 1) % levels.length;
    if (levels[li] > 1 && levels[prev] === 1) {
      const rect = img.getBoundingClientRect();
      const cx = e.clientX - rect.left - rect.width/2;
      const cy = e.clientY - rect.top - rect.height/2;
      curX = -cx; curY = -cy;
    } else if (levels[li] === 1) { curX = curY = 0; }
    apply();
  });
  img.addEventListener('mousedown', (e)=>{ if(levels[li]===1) return; dragging=true; startX=e.clientX - curX; startY=e.clientY - curY; apply(); });
  window.addEventListener('mousemove', (e)=>{ if(!dragging) return; curX = e.clientX - startX; curY = e.clientY - startY; apply(); });
  window.addEventListener('mouseup', ()=>{ if(!dragging) return; dragging=false; apply(); });

  const onClose = () => { window.removeEventListener('mousemove',()=>{}); window.removeEventListener('mouseup',()=>{}); dialog.removeEventListener('close', onClose); };
  dialog.addEventListener('close', onClose);
}

// THREE helpers (lazy)
let threeCache = null; // { THREE, OrbitControls, GLTFLoader, DRACOLoader, RGBELoader }
async function ensureThree() {
  if (threeCache) return threeCache;
  const [THREE, controlsMod, gltfMod, dracoMod, rgbeMod] = await Promise.all([
    import('three'),
    import('https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js?module'),
    import('https://unpkg.com/three@0.161.0/examples/jsm/loaders/GLTFLoader.js?module'),
    import('https://unpkg.com/three@0.161.0/examples/jsm/loaders/DRACOLoader.js?module'),
    import('https://unpkg.com/three@0.161.0/examples/jsm/loaders/RGBELoader.js?module')
  ]);
  threeCache = { THREE, OrbitControls: controlsMod.OrbitControls, GLTFLoader: gltfMod.GLTFLoader, DRACOLoader: dracoMod.DRACOLoader, RGBELoader: rgbeMod.RGBELoader };
  return threeCache;
}

function showProgress(p){ if(!lbProgress||!lbBar||!lbLabel) return; lbProgress.hidden=false; const pct = Math.round(Math.max(0, Math.min(100, p))); lbBar.style.width = pct + '%'; lbLabel.textContent = pct + '%'; dialog.setAttribute('aria-busy','true'); }
function hideProgress(){ if(lbProgress){ lbProgress.hidden=true; dialog.setAttribute('aria-busy','false'); } }

// 3D Lightbox mit Progress, Zoomâ€‘Limits, optional HDRI & Dracoâ€‘Fallback
async function openLightboxForGLTF(item) {
  lbStage.innerHTML = '';
  showProgress(1);
  const { THREE, OrbitControls, GLTFLoader, DRACOLoader, RGBELoader } = await ensureThree();
  const canvas = document.createElement('canvas'); lbStage.appendChild(canvas);
  const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  renderer.toneMapping = THREE.ACESFilmicToneMapping; renderer.toneMappingExposure = 1.0;
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, 1, 0.1, 100);
  camera.position.set(0.8, 0.6, 1.5);
  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; controls.enableZoom = true; controls.minDistance = 0.5; controls.maxDistance = 8; controls.enablePan = true;

  const hemi = new THREE.HemisphereLight(0xffffff, 0x222233, 0.9); scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(2,2,2); scene.add(dir);

  // Optional HDRI
  if (item.env) {
    try {
      const pmrem = new THREE.PMREMGenerator(renderer); pmrem.compileEquirectangularShader();
      const rgbe = new RGBELoader(); const tex = await rgbe.loadAsync(item.env); const envMap = pmrem.fromEquirectangular(tex).texture; scene.environment = envMap; tex.dispose();
    } catch(e) { console.warn('HDRI konnte nicht geladen werden', e); }
  }

  const loader = new GLTFLoader();
  const onProgress = (e) => { if(e && e.lengthComputable){ showProgress((e.loaded/e.total)*100); } else { showProgress(30); } };
  function loadWith(optionalDraco=false){
    return new Promise((resolve,reject)=>{
      if (optionalDraco) { const draco = new DRACOLoader(); draco.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/'); loader.setDRACOLoader(draco); }
      loader.load(item.src, (g)=>resolve(g), onProgress, (err)=>reject(err));
    });
  }

  let gltf = null;
  try { gltf = await loadWith(false); }
  catch(err1){ console.warn('Ohne Draco fehlgeschlagen, versuche mit Dracoâ€¦', err1); try { gltf = await loadWith(true); } catch(err2){ console.error('Laden fehlgeschlagen', err2); hideProgress(); lbStage.innerHTML = '<p class="muted">Fehler beim Laden des Modells. PrÃ¼fe Pfad/Datei.</p>'; return; } }

  hideProgress();
  const root = gltf.scene; scene.add(root);
  // Autoâ€‘frame
  const box = new THREE.Box3().setFromObject(root);
  const size = box.getSize(new THREE.Vector3());
  const center = box.getCenter(new THREE.Vector3());
  root.position.sub(center);
  const radius = Math.max(size.x, size.y, size.z) * 0.6;
  camera.position.set(radius*1.2, radius*0.9, radius*1.6);
  controls.target.set(0, 0, 0); controls.update();

  function resize(){ const w = lbStage.clientWidth; const h = Math.min(window.innerHeight*0.72, w*0.75); renderer.setSize(w, h, false); camera.aspect = w/h; camera.updateProjectionMatrix(); }
  const ro = new ResizeObserver(resize); ro.observe(lbStage); resize();

  let animId; (function render(){ controls.update(); renderer.render(scene, camera); animId = requestAnimationFrame(render); })();

  lbTitle.textContent = item.title; lbTags.textContent = item.desc || (item.tags?.join(', ') || ''); dialog.showModal(); focusClose();

  const onClose = () => { cancelAnimationFrame(animId); renderer.dispose(); ro.disconnect(); dialog.removeEventListener('close', onClose); };
  dialog.addEventListener('close', onClose);
}

// Karte
function makeCard(item){
  const el = document.createElement('article'); el.className = 'card';
  el.innerHTML = `<figure><img src="${item.thumb}" alt="${item.title}"></figure><div class="meta"><span>${item.title}</span><span class="tag">${(item.tags&&item.tags[0])||''}</span></div>`;
  el.addEventListener('click', ()=> item.type==='image' ? openLightboxForImage(item) : openLightboxForGLTF(item));
  return el;
}

// Render Router
const pageRoot = document.querySelector('[data-page]');
if (pageRoot) {
  const mode = pageRoot.getAttribute('data-page');
  const data = window.GALLERY_DATA || { twoD:[], threeD:[] };
  if (mode==='2d') data.twoD.forEach(i=>pageRoot.appendChild(makeCard(i)));
  else if (mode==='3d') data.threeD.forEach(i=>pageRoot.appendChild(makeCard(i)));
  else if (mode==='featured') data.twoD.slice(0,6).forEach(i=>pageRoot.appendChild(makeCard(i)));
}

// Landingâ€‘Hero Three.js
const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
if (!reduceMotion && document.getElementById('bg')) {
  (async () => {
    const [THREE, controlsMod] = await Promise.all([
      import('three'),
      import('https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js?module')
    ]);
    const { OrbitControls } = controlsMod;
    const canvas = document.getElementById('bg');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(55, 1, 0.1, 200);
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; controls.enableZoom = false; controls.enablePan = false; controls.autoRotate = true; controls.autoRotateSpeed = 0.6;
    function resize(){ const {clientWidth:w, clientHeight:h} = canvas.parentElement; renderer.setSize(w,h,false); camera.aspect=w/h; camera.updateProjectionMatrix(); }
    new ResizeObserver(resize).observe(canvas.parentElement);
    const hemi = new THREE.HemisphereLight(0x9fd3ff, 0x0a0a12, 0.9); scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(2,2,3); scene.add(dir);
    const starGeo = new THREE.BufferGeometry(); const COUNT=600; const positions=new Float32Array(COUNT*3);
    for(let i=0;i<COUNT;i++){ const r=THREE.MathUtils.randFloat(20,80); const theta=Math.random()*Math.PI*2; const phi=Math.acos(THREE.MathUtils.randFloatSpread(2)); positions[i*3]=r*Math.sin(phi)*Math.cos(theta); positions[i*3+1]=r*Math.sin(phi)*Math.sin(theta); positions[i*3+2]=r*Math.cos(phi); }
    starGeo.setAttribute('position', new THREE.BufferAttribute(positions,3));
    const starMat = new THREE.PointsMaterial({ size:0.06, transparent:true, opacity:0.85 });
    const stars = new THREE.Points(starGeo, starMat); scene.add(stars);
    const ico = new THREE.Mesh(new THREE.IcosahedronGeometry(2.2,0), new THREE.MeshStandardMaterial({ color:0x8bd3dd, metalness:0.35, roughness:0.3, flatShading:true })); scene.add(ico);
    camera.position.set(0,0.4,8); resize();
    let t=0; (function animate(){ t+=0.006; ico.rotation.x+=0.0035; ico.rotation.y+=0.0055; ico.position.y=Math.sin(t)*0.25; stars.rotation.y+=0.0008; controls.update(); renderer.render(scene,camera); requestAnimationFrame(animate);} )();
    window.addEventListener('scroll', ()=>{ const p=Math.min(window.scrollY/window.innerHeight,1); camera.position.z=8+p*1.2; }, {passive:true});
  })();
}
